<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lotte.chamomile.admin.authuser.domain.AuthUserMapper">

	<select id="findAuthUserUnMappedList" parameterType="String" resultType="net.lotte.chamomile.admin.authtree.AuthTreeVO">
		SELECT
		    A.ROLE_ID   roleId
			 ,A.ROLE_NAME roleName
		FROM
		    CHMM_ROLE_INFO A
		LEFT JOIN
		    CHMM_USER_ROLE_MAP B
		ON
		    A.ROLE_ID = B.ROLE_ID AND
		    B.USER_ID = #{userId}
		WHERE
		    B.ROLE_ID IS NULL
		ORDER BY
		    A.ROLE_ID
	</select>
	
	<select id="findAuthUser" parameterType="String" resultType="net.lotte.chamomile.admin.authtree.AuthTreeVO">
		SELECT
		    A.ROLE_ID   roleId
		   ,A.ROLE_NAME roleName
		FROM
		    CHMM_ROLE_INFO A
		INNER JOIN
		    CHMM_USER_ROLE_MAP B
		ON
		    A.ROLE_ID = B.ROLE_ID
		WHERE
		    B.USER_ID = #{userId}
		ORDER BY
		    A.ROLE_ID
	</select>

	<select id="findAuthUserGroup" parameterType="String" resultType="net.lotte.chamomile.admin.authtree.AuthTreeVO">
		SELECT
		    A.ROLE_ID       roleId
		   ,A.ROLE_NAME     roleName
			 ,B.GROUP_ID      groupId
		   ,D.GROUP_NAME    groupName
		FROM
		    CHMM_ROLE_INFO A
		INNER JOIN
		    CHMM_GROUP_ROLE_MAP B
		ON
		    A.ROLE_ID = B.ROLE_ID
		INNER JOIN
		    CHMM_USER_GROUP_MAP C
		ON
		    B.GROUP_ID = C.GROUP_ID
    INNER JOIN
        CHMM_GROUP_INFO D
    ON
        C.GROUP_ID = D.GROUP_ID
		WHERE
		    C.USER_ID  = #{userId}
		ORDER BY
		    A.ROLE_ID
	</select>
	
	<insert id="insertAuthUser" parameterType="net.lotte.chamomile.admin.authuser.domain.AuthUserVO">
		INSERT INTO CHMM_USER_ROLE_MAP
		   (USER_ID
		   ,ROLE_ID
		   ,USE_YN
		   ,SYS_INSERT_DTM)
		VALUES
		   (#{userId}
			 ,#{roleId}
			 ,'1'
			 ,#{sysInsertDtm})
	</insert>
	
	<delete id="deleteAuthUser" parameterType="net.lotte.chamomile.admin.authuser.domain.AuthUserVO">
		DELETE 
		FROM
		    CHMM_USER_ROLE_MAP
		<where>
				USER_ID = #{userId}
		</where>
	</delete>

  <insert id="insertAuthUserExcel" parameterType="net.lotte.chamomile.admin.authuser.domain.AuthUserExcelUploadVO">
    INSERT INTO CHMM_USER_ROLE_MAP
    (USER_ID
    ,ROLE_ID
    ,USE_YN
    ,SYS_INSERT_DTM)
    VALUES
      (#{userId}
      ,#{roleId}
      ,#{useYn}
      ,#{sysInsertDtm})
  </insert>

</mapper>
